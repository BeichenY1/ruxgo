# C/C++ 构建过程的思考

C/C++ 项目的构建过程涉及源代码的编译、依赖项的解析、库的链接、以及各种优化等一系列步骤，它直接影响着项目的开发效率和代码质量。当项目规模不断扩大时，构建速度、可维护性、复杂的依赖关系等问题随之产生，与此同时，跨平台的问题也不得不考虑。

构建工具是构建过程优化的关键，在现代化软件工程的衍进下，似乎原有的 Make 构建工具产生了许多不可调和的矛盾：

- 构建一个项目时，首先需要学习 Make 的复杂构建语法，在层层依赖和规则的递进下，轻松达到数千行的境界，或许一些花哨的技巧和想法，别人也很难理解，也不想去维护...

- 重构一个项目时，Make 仅依赖于文件的时间戳来判断是否需要重新构建。那么假如仅修改了文件的时间戳而未对文件内容进行实质性的修改，make一下是不是又会花费大把的时间？当然也可以有一些花哨的操作，同上。

- 管理依赖配置时，似乎无法使用一些插件，也没有类似 crate.io 的生态，手写构建依赖，手写配置扩展...

- 跨平台构建时，需要针对不同的操作系统编写不同的 Makefile，当数千行时，工作量可想而知。当然可以使用 CMake，但又要新学一个工具的构建语法...

国内外研究人员一直在努力探索新的针对 C/C++ 项目的构建工具。例如，CMake 和 Ninja 尝试减轻开发人员在不同平台上进行构建的负担；Bazel 和 Gradle 试图解决待办事项和依赖项管理的问题，并提供更好的性能；Unikraft 的伴生工具 kraft，可以简化和自动化单一工作载荷的 Unikernel 的构建和运行。

当然，回归到构建过程本身，回归到最原始的阶段，也只有诸如 gcc 或 g++ 等一系列过程，Makefile 定制了它。Kraft 在 Unikraft 上的运用给了我一些灵感，似乎模块化的操作系统也可以采用模块化的构建工具，原先臃肿的 Make 工具只需要做些减法，当然形式不能太灵活。于是，在最原始的编译基础上，加上预编译、增量编译、并行构建、包管理等等，或许能组装出不错的构建工具！如果是组件化操作系统，还可以针对其进行定制化处理。

另一个想解决的是学习曲线和语法问题。Cargo 工具在构建项目的过程中，充分利用了 Cargo.toml 和 config.toml 两个文件，即完成了整个项目的所有配置，用户也可以在 Toml 文件中进行一些花哨的操作以实现定制化！或许语义明显、配置最小化且多平台支持的 [TOML](https://github.com/toml-lang/toml) 可以在新的组件化构建工具中大展拳脚。当然，如果只需要一个 TOML 文件就能构建出整个 C/C++ 项目，并且构建出运行于组件化操作系统上的 C/C++ 项目，应该是件令人兴奋的事情。

所以 Ruxgo!